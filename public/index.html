<!doctype html>
<meta charset="utf-8">
<title>EPUB ➜ PDF Converter</title>
<style>
 body{font-family:system-ui;padding:2rem;max-width:30rem;margin:auto}
 label{display:block;margin:1rem 0}
 button{padding:.5rem 1rem;border:0;border-radius:.3rem;cursor:pointer}
</style>

<h1>EPUB ➜ PDF Converter</h1>
<form id="form">
  <label>
    Select EPUB:
    <input type="file" name="epub" accept=".epub" required>
  </label>

  <label>
    Page size:
    <select name="pageSize">
      <option value="a5" selected>A5 (Daylight default)</option>
      <option value="a4">A4</option>
      <option value="letter">Letter</option>
    </select>
  </label>

  <label>
    Margin (pt):
    <input type="number" name="margin" value="36" min="0" max="100">
  </label>

  <button>Convert</button>
</form>

<script>
document.getElementById("form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const btn = e.target.querySelector("button");
  btn.disabled = true; btn.textContent = "Converting…";

  const r = await fetch("/convert", { method:"POST", body:fd });
  if(r.ok){
    const blob = await r.blob();
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = fd.get("epub").name.replace(/\.epub$/i,".pdf");
    a.click();
  } else if(r.status === 429){
    alert("Whoa there! Rate limit hit – try again later.");
  } else {
    alert("Conversion failed");
  }
  btn.disabled = false; btn.textContent = "Convert";
});
</script> 